{% extends "base.html" %}
{% block content %}
<h1>Welcome Coach {{ user.username }}</h1>

<!-- Match Creation Form -->
<div class="match-creation-form">
    <h2>Create New Match</h2>
    <form id="matchForm" method="POST" action="/create_match/{{ user.id }}/">
        {% csrf_token %}
        <div class="form-group">
            <label>Date:</label>
            <input type="date" name="date" required>
        </div>
        
        <div class="form-group">
            <label>Time Slot (1-7):</label>
            <input type="number" name="start_slot" min="1" max="7" required>
            <small>Each match takes 2 consecutive slots</small>
        </div>

        <div class="form-group">
            <label>Hall:</label>
            <select name="hall_id" required>
                {% for hall in halls %}
                    <option value="{{ hall.id }}">{{ hall.hallName }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Table:</label>
            <select name="table_id" required>
                {% for table in tables %}
                    <option value="{{ table.id }}">Table {{ table.tableNo }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Your Team:</label>
            <select name="team1_id" required>
                {% for team in coach_teams %}
                    <option value="{{ team.id }}">{{ team.teamName }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Opposing Team:</label>
            <select name="team2_id" required>
                {% for team in all_teams %}
                    <option value="{{ team.id }}">{{ team.teamName }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Arbiter:</label>
            <select name="arbiter_id" required>
                {% for arbiter in arbiters %}
                    <option value="{{ arbiter.id }}">{{ arbiter.name }} {{ arbiter.surname }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit">Create Match</button>
    </form>
</div>

<!-- Team Matches Section -->
<div class="team-matches">
    <h2>Team Matches</h2>
    <div class="matches-list">
        {% for match in team_matches %}
        <div class="match-card">
            <div class="match-info">
                <p><strong>Date:</strong> {{ match.date }}</p>
                <p><strong>Time Slot:</strong> {{ match.timeSlot }}</p>
                <p><strong>Hall:</strong> {{ match.hallName }}</p>
                <p><strong>Table:</strong> {{ match.tableNo }}</p>
                <p><strong>Teams:</strong> {{ match.team1Name }} vs {{ match.team2Name }}</p>
                <p><strong>Arbiter:</strong> {{ match.arbiterName }}</p>
            </div>
            
            {% if match.is_coach_team1 %}
                <div class="player-assignment">
                    <h4>Assign Your Player</h4>
                    {% if not match.white_player %}
                        <form method="POST" action="/assign_player/{{ user.id }}/{{ match.matchID }}/">
                            {% csrf_token %}
                            <select name="player_id" required>
                                <option value="">Select a player</option>
                                {% for player in team_players %}
                                    <option value="{{ player.user_id }}">
                                        {{ player.name }} {{ player.surname }} (Rating: {{ player.elo_rating }})
                                    </option>
                                {% endfor %}
                            </select>
                            <button type="submit">Assign Player</button>
                        </form>
                    {% else %}
                        <p>Assigned Player: {{ match.white_player_name }}</p>
                    {% endif %}
                </div>
            {% else %}
                <div class="player-assignment">
                    <h4>Opponent's Player</h4>
                    {% if match.black_player %}
                        <p>Assigned Player: {{ match.black_player_name }}</p>
                    {% else %}
                        <p>Waiting for opponent to assign player</p>
                    {% endif %}
                </div>
            {% endif %}
        </div>
        {% empty %}
        <p>No matches scheduled for your team.</p>
        {% endfor %}
    </div>
</div>

{% if request.GET.error %}
<div class="error">{{ request.GET.error }}</div>
{% endif %}
{% if request.GET.success %}
<div class="success">{{ request.GET.success }}</div>
{% endif %}

<style>
    .match-creation-form {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
    }
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover {
        background-color: #45a049;
    }
    .error {
        color: red;
        margin: 10px 0;
    }
    .success {
        color: green;
        margin: 10px 0;
    }
    
    .team-matches {
        margin-top: 30px;
    }
    .matches-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .match-card {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        background-color: #fff;
    }
    .match-info p {
        margin: 5px 0;
    }
    .player-assignment {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }
    .player-assignment select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .player-assignment button {
        width: 100%;
    }
</style>
{% endblock %}